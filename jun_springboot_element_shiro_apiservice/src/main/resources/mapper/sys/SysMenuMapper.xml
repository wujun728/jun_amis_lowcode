<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.element.modules.sys.mapper.SysMenuMapper">

    <select id="listMenuByParentId" resultType="com.element.modules.sys.entity.SysMenuEntity">
		SELECT
			*
		FROM
			sys_menu
		WHERE
			parent_id = #{parentId}
		ORDER BY
			order_num ASC
	</select>

    <select id="listMenuNotButton" resultType="com.element.modules.sys.entity.SysMenuEntity">
		SELECT
			*
		FROM
			sys_menu
		WHERE
			type != 2
		ORDER BY
			order_num ASC
	</select>

    <select id="listMenuPermsByUserId" parameterType="Long" resultType="String">
		SELECT
			DISTINCT m.perms
		FROM
			sys_menu m
		LEFT JOIN
			sys_role_menu rm ON m.menu_id = rm.menu_id
	 	LEFT JOIN
	 		sys_user_role ur ON rm.role_id = ur.role_id
	 	LEFT JOIN
	 		sys_role r ON r.role_id = ur.role_id
		WHERE
			ur.user_id = #{userId}
	</select>

    <select id="listMenuTreeAll" resultType="com.element.modules.sys.entity.SysMenuEntity">
		SELECT
			DISTINCT m.menu_id, m.parent_id, m.name, m.path, m.component, m.visible,
			ifnull(m.perms,'') as perms, m.is_frame, m.type, m.icon, m.order_num, m.create_time
		FROM
			sys_menu m
		WHERE
			m.type in (0, 1)
		ORDER BY
			m.parent_id, m.order_num
	</select>

    <select id="listMenuTreeByUserId" resultType="com.element.modules.sys.entity.SysMenuEntity">
		SELECT
			DISTINCT m.menu_id, m.parent_id, m.name, m.path, m.component, m.visible,
			ifnull(m.perms,'') as perms, m.is_frame, m.type, m.icon, m.order_num, m.create_time
		FROM
			sys_menu m
		LEFT JOIN
			sys_role_menu rm on m.menu_id = rm.menu_id
		LEFT JOIN
			sys_user_role ur on rm.role_id = ur.role_id
		LEFT JOIN
			sys_role ro on ur.role_id = ro.role_id
		WHERE
			ur.user_id = #{userId}
		ORDER BY
			m.parent_id, m.order_num
	</select>

</mapper>